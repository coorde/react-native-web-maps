import React, { Component } from 'react';
import { Marker } from 'react-google-maps';

class MapViewMarker extends Component {
  state = {
    isOpen: false,
  };
  showCallout() {
    this.setState({ isOpen: true });
  }
  hideCallout() {
    this.setState({ isOpen: false });
  }
  render() {
    const { num, price, priceTo, status, description, title, coordinate, onPress, ...rest } = this.props;

    const childrenWithProps = React.Children.map(this.props.children, child => {
      return React.cloneElement(child, { hideCallout: this.hideCallout.bind(this) });
    });

    // num = 1;
    // price = "10.0";
    // priceTo = null;
    // status = "usual"; //active. readed, usual

    frameColor = "#0C1010";
    frameBackGroundColor ="#FFFFFF";
    priceColor = "black";
    switch (status) {
      case "active":
          frameColor = "#294CFF";
          frameBackGroundColor ="#294CFF";
          priceColor = "#FFFFFF";
          break;
      case "readed":
          frameColor = "#8F8F8F";
          frameBackGroundColor ="#EAEAEA";
          priceColor = "#0C1010";
          break;
      default:
      }

    priceMarker = null;
    if (priceTo) {
        priceMarker = [
        '<svg width="171" height="41" viewBox="0 0 171 41" fill="none" xmlns="http://www.w3.org/2000/svg">',
            '<rect x="25" y="1" width="145" height="32" fill="'+frameBackGroundColor+'" stroke="' + frameColor +'" stroke-width="2"/>',
            '<rect width="24" height="15" fill="#0C1010"/>',
            '<path d="M98 41L91.9378 33.5H104.062L98 41Z" fill="'+frameColor+'"/>',
            '<path d="M98 38L91.9378 30.5H104.062L98 38Z" fill="'+frameBackGroundColor+'"/>',
            // from
            '<text x="72" y="23" font-size="16px" font-weight="bold" text-anchor="end" fill="'+priceColor+'">' + price + '</text>',
            // to
            '<text x="140" y="23" font-size="16px" font-weight="bold" text-anchor="end" fill="'+priceColor+'">' + priceTo + '</text>',
            //〜万円　　　　万円
            '<path fill="'+priceColor+'" d="M75.86 16.19C75.83 17.42 75.82 17.52 75.72 18.18C75.52 19.51 75.09 20.57 74.39 21.48C73.95 22.05 73.58 22.38 72.85 22.85C73.21 23.14 73.46 23.43 73.69 23.81C74.59 23.17 75.12 22.62 75.65 21.78C76.22 20.86 76.55 19.98 76.76 18.79H79.87C79.8 20.53 79.66 21.75 79.46 22.24C79.35 22.52 79.17 22.6 78.68 22.6C78.29 22.6 77.69 22.52 77.11 22.4C77.27 22.8 77.33 23.09 77.38 23.54C78.26 23.61 78.47 23.62 78.8 23.62C79.79 23.62 80.23 23.4 80.48 22.78C80.73 22.17 80.93 20.58 81 18.82C81.03 17.93 81.03 17.92 81.06 17.69C80.76 17.73 80.37 17.74 79.78 17.74H76.91C76.97 17.19 76.98 16.97 77 16.19H80.75C81.2 16.19 81.63 16.21 82.02 16.25V15.07C81.63 15.11 81.22 15.13 80.74 15.13H74.31C73.82 15.13 73.4 15.11 73.03 15.07V16.25C73.44 16.21 73.86 16.19 74.32 16.19H75.86ZM84.53 19.9H90.48V22.34C90.48 22.58 90.42 22.61 90.03 22.61C89.67 22.61 89.17 22.57 88.51 22.5C88.69 22.91 88.76 23.19 88.82 23.58C89.21 23.6 89.76 23.62 90.15 23.62C90.69 23.62 91.01 23.58 91.2 23.48C91.49 23.33 91.61 23.05 91.61 22.54V16.13C91.61 15.59 91.62 15.33 91.65 15.04C91.41 15.07 91.11 15.08 90.56 15.08H84.48C83.95 15.08 83.69 15.07 83.37 15.04C83.4 15.33 83.41 15.58 83.41 16V22.54C83.41 23.06 83.39 23.42 83.35 23.74H84.58C84.54 23.51 84.53 23.21 84.53 22.58V19.9ZM86.9 18.85H84.53V16.14H86.9V18.85ZM87.98 18.85V16.14H90.48V18.85H87.98ZM93.7 19.96C94.33 19.28 94.79 19.04 95.44 19.04C95.97 19.04 96.28 19.16 97.16 19.72C97.94 20.23 98.14 20.33 98.53 20.46C98.8 20.55 99.11 20.6 99.41 20.6C100.06 20.6 100.63 20.41 101.14 20.03C101.47 19.79 101.68 19.58 102.09 19.06L101.29 18.26C100.94 18.73 100.68 18.95 100.25 19.17C100.01 19.28 99.72 19.36 99.51 19.36C99.03 19.36 98.5 19.15 97.74 18.66C97.09 18.24 97.09 18.24 96.83 18.11C96.4 17.9 96 17.81 95.54 17.81C94.96 17.81 94.51 17.95 93.9 18.33C93.46 18.61 93.28 18.77 92.91 19.22L93.7 19.96ZM144.344 16.19C144.314 17.42 144.304 17.52 144.204 18.18C144.004 19.51 143.574 20.57 142.874 21.48C142.434 22.05 142.064 22.38 141.334 22.85C141.694 23.14 141.944 23.43 142.174 23.81C143.074 23.17 143.604 22.62 144.134 21.78C144.704 20.86 145.034 19.98 145.244 18.79H148.354C148.284 20.53 148.144 21.75 147.944 22.24C147.834 22.52 147.654 22.6 147.164 22.6C146.774 22.6 146.174 22.52 145.594 22.4C145.754 22.8 145.814 23.09 145.864 23.54C146.744 23.61 146.954 23.62 147.284 23.62C148.274 23.62 148.714 23.4 148.964 22.78C149.214 22.17 149.414 20.58 149.484 18.82C149.514 17.93 149.514 17.92 149.544 17.69C149.244 17.73 148.854 17.74 148.264 17.74H145.394C145.454 17.19 145.464 16.97 145.484 16.19H149.234C149.684 16.19 150.114 16.21 150.504 16.25V15.07C150.114 15.11 149.704 15.13 149.224 15.13H142.794C142.304 15.13 141.884 15.11 141.514 15.07V16.25C141.924 16.21 142.344 16.19 142.804 16.19H144.344ZM153.014 19.9H158.964V22.34C158.964 22.58 158.904 22.61 158.514 22.61C158.154 22.61 157.654 22.57 156.994 22.5C157.174 22.91 157.244 23.19 157.304 23.58C157.694 23.6 158.244 23.62 158.634 23.62C159.174 23.62 159.494 23.58 159.684 23.48C159.974 23.33 160.094 23.05 160.094 22.54V16.13C160.094 15.59 160.104 15.33 160.134 15.04C159.894 15.07 159.594 15.08 159.044 15.08H152.964C152.434 15.08 152.174 15.07 151.854 15.04C151.884 15.33 151.894 15.58 151.894 16V22.54C151.894 23.06 151.874 23.42 151.834 23.74H153.064C153.024 23.51 153.014 23.21 153.014 22.58V19.9ZM155.384 18.85H153.014V16.14H155.384V18.85ZM156.464 18.85V16.14H158.964V18.85H156.464Z"/>',
            // top left corner Number
            '<text x="13" y="12" font-size="10" font-weight="bold" text-anchor="middle" fill="white">' + num + '</text>',
        '</svg>'].join('\n');
    } else {
        priceMarker = [
        '<svg width="103" height="41" viewBox="0 0 103 41" fill="none" xmlns="http://www.w3.org/2000/svg">',
            '<rect x="25" y="1" width="77" height="32" fill="'+frameBackGroundColor+'" stroke="'+frameColor+'" stroke-width="2"/>',
            '<rect width="24" height="15" fill="#0C1010"/>',
            '<path d="M64 41L57.9378 33.5H70.0622L64 41Z" fill="'+frameColor+'"/>',
            '<path d="M64 38L57.9378 30.5H70.0622L64 38Z" fill="'+frameBackGroundColor+'"/>',
            '<path  fill="'+priceColor+'" d="M76.1022 16.19C76.0722 17.42 76.0622 17.52 75.9622 18.18C75.7622 19.51 75.3322 20.57 74.6322 21.48C74.1922 22.05 73.8222 22.38 73.0922 22.85C73.4522 23.14 73.7022 23.43 73.9322 23.81C74.8322 23.17 75.3622 22.62 75.8922 21.78C76.4622 20.86 76.7922 19.98 77.0022 18.79H80.1122C80.0422 20.53 79.9022 21.75 79.7022 22.24C79.5922 22.52 79.4122 22.6 78.9222 22.6C78.5322 22.6 77.9322 22.52 77.3522 22.4C77.5122 22.8 77.5722 23.09 77.6222 23.54C78.5022 23.61 78.7122 23.62 79.0422 23.62C80.0322 23.62 80.4722 23.4 80.7222 22.78C80.9722 22.17 81.1722 20.58 81.2422 18.82C81.2722 17.93 81.2722 17.92 81.3022 17.69C81.0022 17.73 80.6122 17.74 80.0222 17.74H77.1522C77.2122 17.19 77.2222 16.97 77.2422 16.19H80.9922C81.4422 16.19 81.8722 16.21 82.2622 16.25V15.07C81.8722 15.11 81.4622 15.13 80.9822 15.13H74.5522C74.0622 15.13 73.6422 15.11 73.2722 15.07V16.25C73.6822 16.21 74.1022 16.19 74.5622 16.19H76.1022ZM84.7722 19.9H90.7222V22.34C90.7222 22.58 90.6622 22.61 90.2722 22.61C89.9122 22.61 89.4122 22.57 88.7522 22.5C88.9322 22.91 89.0022 23.19 89.0622 23.58C89.4522 23.6 90.0022 23.62 90.3922 23.62C90.9322 23.62 91.2522 23.58 91.4422 23.48C91.7322 23.33 91.8522 23.05 91.8522 22.54V16.13C91.8522 15.59 91.8622 15.33 91.8922 15.04C91.6522 15.07 91.3522 15.08 90.8022 15.08H84.7222C84.1922 15.08 83.9322 15.07 83.6122 15.04C83.6422 15.33 83.6522 15.58 83.6522 16V22.54C83.6522 23.06 83.6322 23.42 83.5922 23.74H84.8222C84.7822 23.51 84.7722 23.21 84.7722 22.58V19.9ZM87.1422 18.85H84.7722V16.14H87.1422V18.85ZM88.2222 18.85V16.14H90.7222V18.85H88.2222Z"/>',
            // PRICE
            '<text x="70" y="23" font-size="15px" font-weight="bold" text-anchor="end" fill="'+priceColor+'">' + price + '</text>',
            // top left corner Number
            '<text x="13" y="12" font-size="10" font-weight="bold" text-anchor="middle" fill="white">' + num + '</text>',
        '</svg>'].join('\n');
    }
    var icon = {
        url: 'data:image/svg+xml;charset=UTF-8;base64,' + btoa(priceMarker)
    };

    return (
      <Marker
        {...rest}
        title={description ? `${title}\n${description}` : title}
        icon={icon}
        position={{ lat: coordinate.latitude, lng: coordinate.longitude }}
        onClick={onPress}>
        {this.state.isOpen && childrenWithProps}
      </Marker>
    );
  }
}

export default MapViewMarker;
